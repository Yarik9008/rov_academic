# –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä MS5837 –¥–ª—è STM32F103

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç—á–∏–∫–æ–º –¥–∞–≤–ª–µ–Ω–∏—è MS5837 –Ω–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ STM32F103 (BluePill). –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –æ–ø—Ä–æ—Å –¥–∞—Ç—á–∏–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π –Ω—É–ª–µ–≤–æ–π –≥–ª—É–±–∏–Ω—ã.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –æ–ø—Ä–æ—Å** - –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞** –Ω—É–ª–µ–≤–æ–π –≥–ª—É–±–∏–Ω—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π** –µ—Å–ª–∏ –Ω–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –Ω–µ –≥–æ—Ç–æ–≤–æ
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–π –∫–æ–¥** - –º–∏–Ω–∏–º—É–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

## üîß –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```
MS5837 ‚Üí STM32F103
VCC    ‚Üí 3.3V
GND    ‚Üí GND
SDA    ‚Üí PB7
SCL    ‚Üí PB6
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞

```bash
pio run                    # –ö–æ–º–ø–∏–ª—è—Ü–∏—è
pio run --target upload    # –ó–∞–≥—Ä—É–∑–∫–∞
pio device monitor --port COM17 --baud 115200  # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```

### 2. –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥

```
=== MS5837 —Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π –≤ setup() ===
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–∞...
–î–∞—Ç—á–∏–∫ –≥–æ—Ç–æ–≤!
–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –Ω—É–ª–µ–≤–æ–π –≥–ª—É–±–∏–Ω—ã...
–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ: 1013.25 –º–±–∞—Ä

–ù–∞—á–∏–Ω–∞–µ–º –∏–∑–º–µ—Ä–µ–Ω–∏—è:
–î–∞–≤–ª–µ–Ω–∏–µ	–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞	–ì–ª—É–±–∏–Ω–∞
(–º–±–∞—Ä)		(¬∞C)		(–º)
----------------------------------------
1013.2		23.5		0.00
1013.3		23.5		0.00
```

## üìã –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥

```cpp
#include <Wire.h>
#include "MS5837.h"

MS5837 sensor;
float lastPressure = 0.0, lastTemperature = 0.0, lastDepth = 0.0;
bool hasValidData = false;

void setup() {
    Serial.begin(115200);
    Wire.begin();
    
    sensor.init();
    sensor.setFluidDensity(997); // –ü—Ä–µ—Å–Ω–∞—è –≤–æ–¥–∞
    
    // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    while (!sensor.isReady()) {
        sensor.continueInit();
        delay(10);
    }
    
    // –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –Ω—É–ª–µ–≤–æ–π –≥–ª—É–±–∏–Ω—ã
    while (!sensor.read()) delay(10);
    sensor.calibrateSurface();
    
    Serial.println("–î–∞—Ç—á–∏–∫ –≥–æ—Ç–æ–≤!");
}

void loop() {
    if (sensor.read()) {
        // –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        lastPressure = sensor.pressure();
        lastTemperature = sensor.temperature();
        lastDepth = sensor.depth();
        hasValidData = true;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    if (hasValidData) {
        Serial.print(lastPressure, 1);
        Serial.print("\t\t");
        Serial.print(lastTemperature, 1);
        Serial.print("\t\t");
        Serial.print(lastDepth, 2);
        Serial.println();
    }
}
```

## üõ†Ô∏è API –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|-------|----------|------------|
| `init()` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–∞ | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `isReady()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ | `true` –µ—Å–ª–∏ –≥–æ—Ç–æ–≤ |
| `continueInit()` | –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ | - |
| `setFluidDensity(density)` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∂–∏–¥–∫–æ—Å—Ç–∏ | - |

### –ò–∑–º–µ—Ä–µ–Ω–∏—è

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|-------|----------|------------|
| `read()` | –ó–∞–ø—É—Å–∫ –∏–∑–º–µ—Ä–µ–Ω–∏—è | `true` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ |
| `pressure()` | –î–∞–≤–ª–µ–Ω–∏–µ –≤ –º–±–∞—Ä | `float` |
| `temperature()` | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ ¬∞C | `float` |
| `depth()` | –ì–ª—É–±–∏–Ω–∞ –≤ –º–µ—Ç—Ä–∞—Ö | `float` |

### –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `calibrateSurface()` | –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –Ω—É–ª–µ–≤–æ–π –≥–ª—É–±–∏–Ω—ã |

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–ª–æ—Ç–Ω–æ—Å—Ç—å –∂–∏–¥–∫–æ—Å—Ç–∏

```cpp
sensor.setFluidDensity(997);  // –ü—Ä–µ—Å–Ω–∞—è –≤–æ–¥–∞ (–∫–≥/–º¬≥)
sensor.setFluidDensity(1025); // –ú–æ—Ä—Å–∫–∞—è –≤–æ–¥–∞ (–∫–≥/–º¬≥)
```

### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –≥–ª—É–±–∏–Ω—ã

```
depth = (pressure - surface_pressure) / (density * 9.80665)
```

## üìà –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **–ß–∞—Å—Ç–æ—Ç–∞ –æ–ø—Ä–æ—Å–∞**: 25 –ì—Ü (40–º—Å –Ω–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–µ)
- **–¢–æ—á–Ω–æ—Å—Ç—å**: ¬±0.1% –¥–∞–≤–ª–µ–Ω–∏—è, ¬±0.1¬∞C —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
- **–î–∏–∞–ø–∞–∑–æ–Ω**: 0-30 –±–∞—Ä (0-300 –º–µ—Ç—Ä–æ–≤ –≥–ª—É–±–∏–Ω—ã)
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: ~100–º—Å (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è)

## üîç –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

```cpp
enum State {
    IDLE,              // –ì–æ—Ç–æ–≤ –∫ –∏–∑–º–µ—Ä–µ–Ω–∏—é
    INIT_RESET,        // –°–±—Ä–æ—Å –¥–∞—Ç—á–∏–∫–∞
    INIT_READ_PROM,    // –ß—Ç–µ–Ω–∏–µ –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    READ_REQUEST_D1,   // –ó–∞–ø—Ä–æ—Å –¥–∞–≤–ª–µ–Ω–∏—è
    READ_WAIT_D1,      // –û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è
    READ_GET_D1,       // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è
    READ_REQUEST_D2,   // –ó–∞–ø—Ä–æ—Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
    READ_WAIT_D2,      // –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
    READ_GET_D2,       // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
    READ_COMPLETE      // –ò–∑–º–µ—Ä–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
};
```

## üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```cpp
void setup() {
    sensor.init();
    sensor.setFluidDensity(997);
    
    while (!sensor.isReady()) {
        sensor.continueInit();
        delay(10);
    }
    
    while (!sensor.read()) delay(10);
    sensor.calibrateSurface();
}
```

### –ò–∑–º–µ—Ä–µ–Ω–∏—è –≤ —Ü–∏–∫–ª–µ

```cpp
void loop() {
    if (sensor.read()) {
        Serial.print("P: ");
        Serial.print(sensor.pressure(), 1);
        Serial.print(" T: ");
        Serial.print(sensor.temperature(), 1);
        Serial.print(" D: ");
        Serial.print(sensor.depth(), 2);
        Serial.println();
    }
}
```

### –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏

```cpp
void calibrateAtSurface() {
    if (sensor.read()) {
        sensor.calibrateSurface();
        Serial.print("–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ: ");
        Serial.print(sensor.pressure(), 2);
        Serial.println(" –º–±–∞—Ä");
    }
}
```

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**: STM32F103 (BluePill)
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: PlatformIO + Arduino Framework
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏**: Wire (I2C)
- **–ü–∏–Ω—ã I2C**: PB6 (SCL), PB7 (SDA)
- **–î–∞—Ç—á–∏–∫**: MS5837 (30 –±–∞—Ä)

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –¥–∞—Ç—á–∏–∫** —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ
2. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥** –Ω–∞ STM32F103
3. **–û—Ç–∫—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä** —Å–µ—Ä–∏–π–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞
4. **–ü–æ–º–µ—Å—Ç–∏—Ç–µ –¥–∞—Ç—á–∏–∫** –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –≤–æ–¥—ã –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
5. **–ù–∞–±–ª—é–¥–∞–π—Ç–µ** –∑–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üéØ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞ MS5837
- –ò–∑—É—á–µ–Ω–∏–µ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –¥–ª—è ROV
- –ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∏–∑–º–µ—Ä–µ–Ω–∏—è –≥–ª—É–±–∏–Ω—ã

---
